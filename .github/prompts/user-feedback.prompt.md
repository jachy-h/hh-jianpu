# 用户反馈闭环工作流

当用户以 `feedback:` 开头描述建议时，按照 **理解 → 评估 → 实施 → 验证** 四步流程执行。

你需要作为音乐专业人士， 评判用户需求是否合理。

如果是已经实现的功能，需要完善帮助页面或示例代码，则直接进入第三步。



---

## 触发条件

用户消息以 `feedback:` 开头，格式：

```
feedback: [简短描述]

[可选] 使用场景 / 期望效果 / 参考案例
```

---

## 第一步：理解需求

**目标**: 明确用户需求和痛点，挖掘真实意图。

**操作**:
1. 分析用户描述的使用场景和期望
2. 识别核心痛点（效率、体验、功能缺失等）
3. 如有歧义，列出可能的理解方式
4. 搜索现有代码，确认功能是否已存在

**输出格式**:
```
## 需求理解

**用户痛点**: 简述当前的问题或不便

**核心诉求**: 用户真正想要的是什么

**使用场景**: 在什么情况下会用到

**是否已存在**: ✅ 已有类似功能（位置）/ ❌ 确认缺失
```

**如果已存在**：说明使用方法，无需继续。
**如果需要澄清**：列出疑问点，等待用户回复后再继续。

---

## 第二步：评估可行性

**前置条件**: 第一步明确了需求。

**操作**:
1. 技术可行性：与现有架构是否兼容
2. 工作量评估：修改范围和复杂度
3. 优先级判断：紧急程度和影响面
4. 潜在风险：可能引入的问题

**输出格式**:
```
## 可行性评估

**技术可行性**: ✅ 容易 / ⚠️ 需要重构 / ❌ 架构不支持

**工作量**: 🟢 简单（<1小时）/ 🟡 中等（1-4小时）/ 🔴 复杂（>4小时）

**优先级**: 🔥 高（核心体验）/ 📌 中（改进体验）/ 💡 低（锦上添花）

**潜在风险**: 列出可能的副作用和影响范围

**建议**: 立即实施 / 延期处理 / 需要讨论 / 不建议
```

**如果不建议实施**：说明理由（架构限制、性能问题、维护成本等）。

---

## 第三步：设计与实施

**前置条件**: 第二步评估通过，决定实施。

**操作**:
1. 使用 `manage_todo_list` 拆解实施步骤
2. 设计方案：
   - 涉及的文件和模块
   - API 或接口设计
   - UI/UX 变更（如有）
   - 配置或文档更新
3. 编写代码，遵循项目规范（参见 `.agent/instructions.md`）
4. 添加必要的单元测试
5. 更新相关文档（README、CHANGELOG 等）

**输出格式**:
```
## 实施方案

**涉及文件**: 列出需要修改/新增的文件

**核心改动**: 
- 文件1：改动描述
- 文件2：改动描述

**配套工作**:
- [ ] 单元测试
- [ ] 文档更新
- [ ] 示例代码
```

---

## 第四步：验证与反馈

**目标**: 确保功能符合预期，收集用户反馈。

**操作**:
1. 运行单元测试（`run_in_terminal`）
2. 检查 TypeScript 错误（`get_errors`）
3. 手动验证功能是否满足第一步的核心诉求
4. 评估用户体验：是否直观、易用
5. 记录已知限制和未来改进方向

**输出格式**:
```
## 验证结果

- [x/] 单元测试通过
- [x/] 无 TypeScript 错误
- [x/] 核心功能正常
- [x/] 用户体验符合预期

**功能亮点**: 简述实现的功能和优势

**已知限制**: 当前实现的局限性（如有）

**未来改进**: 可以进一步优化的方向
```

**最后**：
- 给出建议的 commit message，格式 `feat: <描述>`
- 询问用户是否还有其他需求或调整

---

## 关键原则

- **深度理解**：不要根据字面意思直接实现，挖掘真实需求
- **主动评估**：技术可行性和优先级要客观判断，不盲目接受所有需求
- **用户视角**：实现时考虑易用性和直观性，不只是完成功能
- **持续改进**：收集反馈，迭代优化，形成闭环
- **完整交付**：代码 + 测试 + 文档，三者缺一不可

---

## 与 Bug 修复的区别

| 维度 | Bug 修复 | 用户反馈 |
|------|----------|----------|
| **触发词** | `bug:` | `feedback:` |
| **性质** | 修复已有功能的错误 | 新增/改进功能 |
| **流程** | 验证 → 修复 → 回归 | 理解 → 评估 → 实施 → 验证 |
| **重点** | 快速定位、最小化改动 | 深度理解、体验优化 |
| **commit** | `fix:` | `feat:` 或 `refactor:` |
