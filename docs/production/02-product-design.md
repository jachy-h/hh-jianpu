# 产品原型设计 — hh-jianpu 动态简谱

> 设计原则：**极简克制**。只做用户真正需要的，砍掉一切"觉得可以加"的东西。

---

## 一、产品定位

**一句话描述：** 粘贴简谱文本 → 看到漂亮曲谱 → 按下播放跟着练

**不做什么（红线）：**
- ❌ 不做社区/分享/账号系统
- ❌ 不做五线谱
- ❌ 不做 MIDI 导入/导出（MVP 阶段）
- ❌ 不做多声部/和弦编排
- ❌ 不做乐器音色选择（MVP 只用简洁的合成音）

---

## 二、信息架构

整个应用只有 **一个页面**，分为两个模式：

```
┌─────────────────────────────────────┐
│           hh-jianpu                    │
├─────────────────────────────────────┤
│                                     │
│     [ 编辑模式 ] ←→ [ 演奏模式 ]      │
│                                     │
└─────────────────────────────────────┘
```

### 编辑模式
- 左侧/上方：文本编辑区（输入简谱源码）
- 右侧/下方：实时预览渲染后的简谱

### 演奏模式
- 全屏显示渲染后的简谱
- 底部固定播放控制栏
- 当前音符高亮跟踪

---

## 三、页面布局（极简线框）

### 3.1 编辑模式（桌面端）

```
┌──────────────────────────────────────────────────┐
│  🎵 hh-jianpu                        [▶ 演奏模式]   │
├────────────────────┬─────────────────────────────┤
│                    │                             │
│   简谱文本编辑区     │     实时预览区               │
│                    │                             │
│   标题: 小星星      │     ♩ 小星星                 │
│   调号: C          │     1=C  4/4  ♩=120         │
│   拍号: 4/4        │                             │
│   速度: 120        │     1  1  5  5 | 6  6  5 -  │
│                    │     4  4  3  3 | 2  2  1 -  │
│   1 1 5 5|6 6 5 - │     ...                     │
│   4 4 3 3|2 2 1 - │                             │
│   ...              │                             │
│                    │                             │
│                    │                             │
├────────────────────┴─────────────────────────────┤
│  示例曲谱: [小星星] [生日快乐] [欢乐颂]            │
└──────────────────────────────────────────────────┘
```

### 3.2 演奏模式（桌面端）

```
┌──────────────────────────────────────────────────┐
│  🎵 小星星                          [✏️ 编辑模式]  │
├──────────────────────────────────────────────────┤
│                                                  │
│                 1=C  4/4  ♩=120                   │
│                                                  │
│     1   1   5   5  │  6   6   [5]  -             │
│                         当前音符 ↑ 高亮            │
│     4   4   3   3  │  2   2    1   -             │
│                                                  │
│     5   5   4   4  │  3   3    2   -             │
│                                                  │
│     ...                                          │
│                                                  │
├──────────────────────────────────────────────────┤
│  [|◁]  [▶ 播放]  [▷|]     ♩= [──●──] 120        │
│                            速度滑块               │
└──────────────────────────────────────────────────┘
```

### 3.3 移动端（竖屏）

```
┌────────────────────┐
│ 🎵 hh-jianpu   [模式]  │
├────────────────────┤
│                    │
│  编辑模式:          │
│  全宽文本编辑区      │
│  ─── 分割线 ───     │
│  全宽预览区         │
│                    │
│  演奏模式:          │
│  全宽简谱显示       │
│  ──────────────    │
│  [◁][▶][▷] ♩=120  │
│                    │
└────────────────────┘
```

---

## 四、核心交互流程

### 4.1 首次使用流程

```
打开网页
  ↓
看到编辑区已预填「小星星」示例曲谱
  ↓
预览区自动渲染出简谱 → 用户立刻理解"原来是这样用的"
  ↓
点击 [▶ 演奏模式]
  ↓
简谱全屏展示，点击播放 → 听到旋律、看到音符逐个高亮
  ↓
用户理解完整流程，回到编辑模式粘贴自己的谱子
```

### 4.2 核心交互细节

| 交互 | 行为 |
|------|-----|
| 在编辑区输入/修改文本 | 预览区实时更新（防抖 300ms） |
| 点击「演奏模式」 | 切换为全屏简谱 + 播放控制栏 |
| 点击「播放」 | 从头开始播放，当前音符高亮，自动滚动 |
| 拖动速度滑块 | 实时改变播放速度（BPM 40-240） |
| 点击简谱中的某个音符 | 从该位置开始播放 |
| 点击「编辑模式」 | 停止播放，返回编辑视图 |
| 语法错误 | 预览区对应位置显示红色波浪线提示 |

---

## 五、视觉设计原则

### 5.1 色彩

| 用途 | 颜色 | 说明 |
|------|------|------|
| 背景 | `#FAFAF9` | 温暖的米白色，像纸张 |
| 文字/音符 | `#1C1917` | 深棕黑，非纯黑 |
| 当前音符高亮 | `#2563EB` | 蓝色，醒目但不刺眼 |
| 已播放音符 | `#94A3B8` | 浅灰，表示"已过" |
| 错误提示 | `#DC2626` | 红色 |
| 小节线 | `#D6D3D1` | 浅灰色细线 |

### 5.2 字体

- 简谱数字：等宽字体（确保音符对齐），推荐 `JetBrains Mono` 或 `Fira Code`
- 标题/元信息：系统无衬线字体
- 编辑区：等宽字体

### 5.3 动效

- 音符高亮：无过渡动画，**即时切换**（跟随节拍，动画反而干扰）
- 模式切换：简单的淡入淡出（200ms）
- 自动滚动：播放时平滑滚动，确保当前行在视口中央

---

## 六、MVP 功能清单（第一版）

### ✅ 必须有（Must Have）
1. 简谱文本输入（带语法高亮的编辑器）
2. 实时渲染简谱预览
3. 演奏模式：播放/暂停/停止
4. 播放时音符高亮跟踪
5. 播放速度调节（BPM 滑块）
6. 内置 2-3 首示例曲谱
7. 响应式布局（桌面 + 移动端）

### 🔜 下一步（Should Have）
8. 点击音符从该位置播放
9. 选段循环播放
10. 变调功能（移调）
11. 简谱文本语法错误提示

### 📌 以后再说（Nice to Have）
12. 导出为图片/PDF
13. 本地存储历史谱子
14. PWA 离线支持
15. 打印友好样式

---

## 七、简谱文本格式规范（v1）

### 元信息区（头部）
```
标题: 曲名
调号: C
拍号: 4/4
速度: 120
```

### 音符区
```
1 2 3 4 | 5 6 7 1' |    基本音符和高八度
.1 .2 3 4 | 5 - - - |   低八度和延长
0 0 1 2 | 3/ 4/ 5 - |   休止符和八分音符（减时线）
```

### 符号表

| 符号 | 含义 | 示例 |
|------|------|------|
| `1-7` | 基本音符 do-si | `1 3 5` |
| `0` | 休止符 | `0 0 1 2` |
| `-` | 延长前一音 | `5 - - -`（全音符） |
| `\|` | 小节线 | `1 2 3 4 \| 5 6 7 1'` |
| `'` 或上标点 | 高八度 | `1'`（高音 do）|
| `.` 前缀 | 低八度 | `.7`（低音 si）|
| `_` | 减时线（半拍） | `1_ 2_`（两个八分音符）|
| `#` | 升半音 | `#4` |
| `b` | 降半音 | `b7` |
| `.` 后缀 | 附点（延长一半时值） | `5.`（附点四分音符）|

> 注：后缀 `.` 与高八度 `'` 不冲突，上下文可区分。附点和高低八度标记在渲染时会转为标准简谱的上下加点表示。

---

## 八、成功指标

| 指标 | 目标 |
|------|------|
| 首次使用到成功播放 | < 30 秒 |
| 粘贴谱子到开始播放 | < 10 秒 |
| 页面加载时间 | < 2 秒 |
| 移动端可用性 | 单手可完成所有操作 |
