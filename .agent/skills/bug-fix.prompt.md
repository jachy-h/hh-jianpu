# Bug 修复工作流

当用户以 `bug:` 开头描述问题时，按照 **验证 → 修复 → 回归** 三步流程执行。

---

## 触发条件

用户消息以 `bug:` 开头，格式：

```
bug: [简短描述]

[可选] 复现步骤 / 预期行为 / 实际行为
```

---

## 第一步：验证 Bug 存在性

**目标**: 确认问题是否真实存在，定位根因。

**操作**:
1. 阅读相关代码（`read_file` / `grep_search` / `semantic_search`）
2. 检查 TypeScript 错误（`get_errors`）
3. 运行相关单元测试
4. 定位根因：是代码bug、配置问题还是设计行为

**输出格式**:
```
## Bug 验证结果

**状态**: ✅ 已确认 / ❌ 无法复现 / ⚠️ 需要更多信息

**根因**: 文件、行号、具体问题描述、影响范围
```

**如果无法复现**：列出尝试步骤，向用户索要更多信息后停止。
**如果是设计行为**：说明原因，建议作为 feature request 而非 bug。

---

## 第二步：实施修复

**前置条件**: 第一步确认 bug 存在。

**操作**:
1. 使用 `manage_todo_list` 记录修复步骤
2. 修改代码，遵循项目代码规范（参见 `.agent/instructions.md`）
3. 为修复添加回归测试（如果缺失）

**输出格式**:
```
## 修复方案

**修改文件**: 列出文件和行号
**修改内容**: 简述改动
```

---

## 第三步：回归验证

**目标**: 确保修复有效且无副作用。

**操作**:
1. 运行单元测试（`run_in_terminal`）
2. 检查 TypeScript 错误（`get_errors`）
3. 根据原始复现步骤验证修复
4. 评估是否引入新问题

**输出格式**:
```
## 回归验证结果

- [x/] 原始 bug 已修复
- [x/] 单元测试通过
- [x/] 无新增 TypeScript 错误
- [x/] 相关功能正常

**副作用**: 无 / 有（说明）
```

**最后**：给出建议的 commit message，格式 `fix: <描述>`。

---

## 关键原则

- **先验证再动手**：不要假设 bug 存在就直接改代码
- **最小化修改**：只改必要的部分，不顺手重构
- **必须有测试**：每个 bug 修复都要有对应的回归测试
- **完整报告**：三步都要有清晰的输出，让用户了解进展
