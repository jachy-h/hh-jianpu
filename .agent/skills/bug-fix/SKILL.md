---
name: bug-fix
description: "Bug 修复工作流 — 验证 → 修复 → 回归三步流程。当用户以 bug: 开头描述问题时触发。"
compatibility: copilot,opencode,qwen,claude
metadata:
  audience: all-agents
  trigger: "bug:"
---

# Bug 修复工作流

当用户以 `bug:` 开头描述问题时，按照 **验证 → 修复 → 回归** 三步流程执行。

---

## 触发条件

用户消息以 `bug:` 开头：

```
bug: [简短描述]

[可选] 复现步骤 / 预期行为 / 实际行为
```

---

## 第一步：验证 Bug 存在性

**目标**: 确认问题是否真实存在，定位根因。

**操作**:
1. 阅读相关代码
2. 检查 TypeScript 错误
3. 运行相关单元测试
4. 定位根因：是代码 bug、配置问题还是设计行为

**输出格式**:
```
## Bug 验证结果

**状态**: ✅ 已确认 / ❌ 无法复现 / ⚠️ 需要更多信息

**根因**: 文件、行号、具体问题描述、影响范围
```

**如果无法复现**：列出尝试步骤，向用户索要更多信息后停止。
**如果是设计行为**：说明原因，建议作为 feature request。

---

## 第二步：实施修复

**前置条件**: 第一步确认 bug 存在。

**操作**:
1. 记录修复步骤（使用 agent 内置 todo 或 `.agent/todos/current.md`）
2. 修改代码，遵循项目规范（参见 `.agent/instructions.md`）
3. 为修复添加回归测试

**输出格式**:
```
## 修复方案

**修改文件**: 列出文件和行号
**修改内容**: 简述改动
```

---

## 第三步：回归验证

**目标**: 确保修复有效且无副作用。

**操作**:
1. 运行单元测试
2. 检查 TypeScript 错误
3. 根据原始复现步骤验证修复
4. 评估是否引入新问题

**输出格式**:
```
## 回归验证结果

- [x/] 原始 bug 已修复
- [x/] 单元测试通过
- [x/] 无新增 TypeScript 错误
- [x/] 相关功能正常
```

**commit**: `fix: <描述>`
